{% extends 'base.html' %}
{% load static %}
{% block title %}Tindak Lanjut Kasus{% endblock %}

{% block content %}
<section class="bk-tindak-lanjut">
<div class="bk-tl-hero">
<div class="container text-center">

<h1 class="bk-tl-title">Tindak Lanjut Kasus Bullying</h1>
<p class="bk-tl-subtitle">
Jaga kerahasiaan data demi keamanan semua pihak
</p>

<div class="bk-tl-card mx-auto mt-5">
<img src="{% static 'img/ribbon.png' %}" class="bk-tl-icon">

<div class="bk-tl-info text-start">

<!-- ================= INFORMASI LAPORAN ================= -->
<h2 class="bk-section-title">ğŸ“„ Informasi Laporan</h2>

<div class="bk-info-grid">
<div><label>Kode Laporan</label><span>{{ laporan.kode_laporan }}</span></div>
<div>
<label>Status</label>
<span class="badge
{% if laporan.status == 'selesai' %}bg-success
{% elif laporan.status == 'diproses' %}bg-warning
{% else %}bg-secondary{% endif %}">
{{ laporan.get_status_display }}
</span>
</div>
<div><label>Tanggal Lapor</label>
<span>{{ laporan.tanggal|date:"d M Y" }}</span>
</div>
</div>


<!-- ================= WAKTU & LOKASI ================= -->
<h2 class="bk-section-title">ğŸ“ Waktu & Lokasi</h2>

<div class="bk-info-grid">
<div>
<label>Waktu Kejadian</label>
<span>
{{ laporan.tanggal_kejadian|date:"d M Y" }}
{% if laporan.perkiraan_waktu %}
({{ laporan.get_perkiraan_waktu_display }})
{% endif %}
</span>
</div>

<div>
<label>Lokasi</label>
<span>{{ laporan.lokasi_kejadian|default:"-" }}</span>
</div>
</div>


<!-- ================= DATA PIHAK TERLIBAT ================= -->
<h2 class="bk-section-title">ğŸ‘¥ Pihak Terlibat</h2>

<div class="bk-info-grid">
<div>
<label>Korban</label>
<span>{{ laporan.tampilkan_korban }} ({{ laporan.kelas_korban }})</span>
</div>

{% if laporan.nama_terlapor %}
<div>
<label>Terlapor</label>
<span>
{{ laporan.nama_terlapor }}
{% if laporan.kelas_terlapor %} ({{ laporan.kelas_terlapor }}) {% endif %}
</span>
</div>
{% endif %}

<div>
<label>Jenis Bullying</label>
<span>{{ laporan.get_jenis_bullying_display }}</span>
</div>
</div>


<!-- INTERNAL KORBAN -->
{% if laporan.is_korban_anonim %}
<details class="bk-detail">
<summary>ğŸ” Identitas Korban (Internal BK)</summary>
<div class="bk-detail-box">
<p><strong>Nama :</strong> {{ laporan.nama_korban }}</p>
<p><strong>Kelas :</strong> {{ laporan.kelas_korban }}</p>
</div>
</details>
{% endif %}


<!-- ================= KRONOLOGI ================= -->
<h2 class="bk-section-title">ğŸ“ Kronologi Kejadian</h2>
<div class="bk-text-box">
{{ laporan.isi_laporan|linebreaksbr }}
</div>


<!-- ================= DAMPAK ================= -->
{% if laporan.dampak_korban %}
<h2 class="bk-section-title">âš  Dampak Korban</h2>
<ul class="bk-list">
{% for d in laporan.dampak_korban %}
<li>{{ d }}</li>
{% endfor %}
</ul>
{% endif %}


{% if laporan.harapan_pelapor %}
<h2 class="bk-section-title">ğŸ’¬ Harapan Pelapor</h2>
<div class="bk-text-box">
{{ laporan.harapan_pelapor|linebreaksbr }}
</div>
{% endif %}


<!-- ================= BUKTI ================= -->
{% if laporan.bukti %}
<a href="{{ laporan.bukti.url }}" target="_blank"
class="bk-tl-btn-success w-100 my-4">
ğŸ“ Lihat Bukti Pelapor
</a>
{% endif %}


<!-- ================= IDENTITAS INTERNAL ================= -->
<details class="bk-detail">
<summary>ğŸ” Identitas Pelapor (Internal BK)</summary>
<div class="bk-detail-box">
<p><strong>Nama :</strong>
{{ laporan.pelapor.get_full_name|default:laporan.pelapor.username }}</p>

<p><strong>NIS :</strong>
{{ laporan.pelapor.profile.nis }}</p>

<p><strong>Kelas :</strong>
{{ laporan.pelapor.profile.kelas }}</p>
</div>
</details>


<!-- ================= FORM BK ================= -->
<h2 class="bk-section-title">ğŸ“Œ Form Tindak Lanjut BK</h2>

<form method="post" enctype="multipart/form-data">
{% csrf_token %}

<label class="bk-tl-label">Catatan Guru BK</label>
{{ form.catatan_bk }}

<label class="bk-tl-label mt-3">Bukti Tindak Lanjut</label>
{{ form.bukti_tindak_lanjut }}

<button type="submit" class="bk-tl-btn-primary w-100 mt-4">
Simpan Tindak Lanjut
</button>

{% if laporan.status != "selesai" %}
<button type="submit" name="selesai" value="1"
class="btn btn-success w-100 mt-2">
Tandai Selesai
</button>
{% endif %}
</form>

<a href="{% url 'bk_dashboard' %}"
class="btn btn-outline-secondary w-100 mt-3">
â† Kembali
</a>

</div>
</div>

</div>
</div>
</section>
{% endblock %}
