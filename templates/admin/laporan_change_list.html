{% extends "admin/change_list.html" %}

{% block result_list %}

<!-- ================= DASHBOARD ================= -->

<div style="margin-bottom:30px;">

<h2>Dashboard Analitik Bullying</h2>

<div style="display:flex; gap:20px; margin:15px 0;">
    <strong>Total: {{ total_laporan }}</strong>
    <strong>Baru: {{ laporan_baru }}</strong>
    <strong>Diproses: {{ sedang_diproses }}</strong>
    <strong>Selesai: {{ selesai }}</strong>
</div>

<div style="display:grid; grid-template-columns:repeat(2,1fr); gap:20px;">

<canvas id="statusChart"></canvas>
<canvas id="jenisChart"></canvas>
<canvas id="kelasChart"></canvas>
<canvas id="trenChart"></canvas>

</div>

</div>

<hr>

<!-- ===== TABEL ADMIN ===== -->
{{ block.super }}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

const chartOptions = {
responsive:true,
maintainAspectRatio:false,
scales:{
y:{
beginAtZero:true,
ticks:{ precision:0 }
}
}
};

/* STATUS */
new Chart(document.getElementById("statusChart"), {
type:'pie',
data:{
labels:[{% for i in grafik_status %}"{{ i.status }}",{% endfor %}],
datasets:[{
data:[{% for i in grafik_status %}{{ i.total }},{% endfor %}],
backgroundColor:[
'#0d6efd',
'#dc3545',
'#198754'
]
}]
}
});

/* JENIS */
new Chart(document.getElementById("jenisChart"), {
type:'bar',
data:{
labels:[{% for i in grafik_jenis %}"{{ i.jenis_bullying }}",{% endfor %}],
datasets:[{
label:'Jumlah',
data:[{% for i in grafik_jenis %}{{ i.total }},{% endfor %}]
}]
},
options:chartOptions
});

/* KELAS */
new Chart(document.getElementById("kelasChart"), {
type:'bar',
data:{
labels:[{% for i in grafik_kelas %}"{{ i.kelas_korban }}",{% endfor %}],
datasets:[{
label:'Jumlah',
data:[{% for i in grafik_kelas %}{{ i.total }},{% endfor %}]
}]
},
options:chartOptions
});

/* TREN */
new Chart(document.getElementById("trenChart"), {
type:'bar',
data:{
labels:[{% for i in grafik_tren %}"{{ i.bulan|date:'M Y' }}",{% endfor %}],
datasets:[{
label:'Jumlah Laporan',
data:[{% for i in grafik_tren %}{{ i.total }},{% endfor %}]
}]
},
options:chartOptions
});

</script>

{% endblock %}
