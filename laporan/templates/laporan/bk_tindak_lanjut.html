{% extends 'base.html' %}
{% load static %}
{% block title %}Tindak Lanjut Kasus{% endblock %}

{% block content %}
<section class="bk-tindak-lanjut">
  <div class="bk-tl-hero">
    <div class="container text-center">

      <h1 class="bk-tl-title">Tindak Lanjut Kasus</h1>
      <p class="bk-tl-subtitle">
        Selalu menjaga kerahasiaan agar merasa aman dan terlindungi
      </p>

      <div class="bk-tl-card mx-auto mt-5">
        <img src="{% static 'img/ribbon.png' %}" class="bk-tl-icon" alt="Icon">

        <div class="bk-tl-info text-start">

          <!-- ================= DATA UMUM ================= -->
          <p><strong>Kode Laporan :</strong> {{ laporan.kode_laporan }}</p>

          <p>
            <strong>Pelapor :</strong>
            {% if laporan.is_anonymous %}
              Anonim üîí
            {% else %}
              Anonim üîí
            {% endif %}
          </p>

          <p><strong>Korban :</strong> {{ laporan.nama_korban }} ({{ laporan.kelas_korban }})</p>

          {% if laporan.nama_terlapor %}
            <p>
              <strong>Terlapor :</strong>
              {{ laporan.nama_terlapor }}
              {% if laporan.kelas_terlapor %}
                ({{ laporan.kelas_terlapor }})
              {% endif %}
            </p>
          {% endif %}

          <p>
            <strong>Jenis Perundungan :</strong>
            {{ laporan.get_jenis_bullying_display }}
          </p>

          <hr>

          <!-- ================= KRONOLOGI ================= -->
          <p>
            <strong>Kronologi Kejadian :</strong><br>
            {{ laporan.isi_laporan|linebreaksbr }}
          </p>

          {% if laporan.bukti %}
            <a href="{{ laporan.bukti.url }}"
               target="_blank"
               class="bk-tl-btn-success w-100 my-3">
              üìé Lihat Bukti Pelapor
            </a>
          {% endif %}

          <hr>

          <!-- ================================================= -->
          <!-- üîê LEVEL 2 : IDENTITAS INTERNAL (GURU BK / ADMIN) -->
          <!-- ================================================= -->
          <details class="mt-4">
            <summary style="cursor:pointer; font-weight:700;">
              üîê Lihat Identitas Pelapor (Internal)
            </summary>

            <div class="mt-3">

              <p><strong>Nama :</strong>
                {{ laporan.pelapor.get_full_name|default:laporan.pelapor.username }}
              </p>

              <div class="bk-tl-nis-row">
                <strong>NIS :</strong>
                <span class="bk-tl-nis">{{ laporan.pelapor.profile.nis }}</span>
              </div>

              <p class="mt-2">
                <strong>Kelas :</strong> {{ laporan.pelapor.profile.kelas }}
              </p>

              <small class="text-muted d-block mt-2">
                Informasi ini bersifat rahasia dan hanya untuk keperluan internal.
              </small>
            </div>
          </details>

          <hr>

          <!-- ================= FORM TINDAK LANJUT ================= -->
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <label class="bk-tl-label">Status Penanganan</label>
            {{ form.status }}

            <label class="bk-tl-label mt-3">Catatan Guru BK</label>
            {{ form.catatan_bk }}

            <label class="bk-tl-label mt-3">
              Bukti Tindak Lanjut (Opsional)
            </label>
            {{ form.bukti_tindak_lanjut }}

            <small class="text-muted">
              File bebas (PDF, gambar, audio, video). Maksimal 10 MB.
            </small>

            <button type="submit"
                    class="bk-tl-btn-primary w-100 mt-4">
              Simpan Tindak Lanjut
            </button>
          </form>

          <a href="{% url 'bk_dashboard' %}"
             class="btn btn-outline-secondary w-100 mt-3">
            ‚Üê Kembali ke Dashboard
          </a>

        </div>
      </div>

    </div>
  </div>
</section>
{% endblock %}
