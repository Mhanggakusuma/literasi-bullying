{% extends "admin/base_site.html" %}

{% block content %}

<h1>Dashboard Analitik Laporan</h1>

<div style="display:grid; grid-template-columns:repeat(2,1fr); gap:30px;">

    <canvas id="jenisChart"></canvas>
    <canvas id="kelasChart"></canvas>
    <canvas id="statusChart"></canvas>
    <canvas id="waktuChart"></canvas>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

const jenisData = JSON.parse('{{ jenis_json|escapejs }}');
const kelasData = JSON.parse('{{ kelas_json|escapejs }}');
const statusData = JSON.parse('{{ status_json|escapejs }}');
const waktuData = JSON.parse('{{ waktu_json|escapejs }}');

function chart(id, labels, data, label){
    new Chart(document.getElementById(id), {
        type:'bar',
        data:{
            labels:labels,
            datasets:[{
                label:label,
                data:data
            }]
        }
    });
}

// Jenis Bullying
chart(
    "jenisChart",
    jenisData.map(x=>x.jenis_bullying),
    jenisData.map(x=>x.total),
    "Jenis Bullying"
);

// Kelas Korban
chart(
    "kelasChart",
    kelasData.map(x=>x.kelas_korban),
    kelasData.map(x=>x.total),
    "Kelas Korban"
);

// Status
chart(
    "statusChart",
    statusData.map(x=>x.status),
    statusData.map(x=>x.total),
    "Status Laporan"
);

// Tren Waktu
chart(
    "waktuChart",
    waktuData.map(x=>new Date(x.bulan).toLocaleDateString("id-ID",{month:'short',year:'numeric'})),
    waktuData.map(x=>x.total),
    "Tren Laporan"
);

</script>

{% endblock %}
