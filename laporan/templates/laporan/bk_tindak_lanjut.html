{% extends 'base.html' %}
{% load static %}
{% block title %}Tindak Lanjut Kasus{% endblock %}

{% block content %}

<section class="bk-tindak-lanjut">

<div class="bk-tl-hero">
<div class="container bk-tl-container">

<!-- HEADER -->
<div class="text-center mb-5">
<h1 class="bk-tl-title">Tindak Lanjut Kasus Bullying</h1>
<p class="bk-tl-subtitle">
Jaga kerahasiaan data demi keamanan dan kenyamanan semua pihak
</p>
</div>

<!-- CARD UTAMA -->
<div class="bk-tl-card">

<img src="{% static 'img/ribbon.png' %}" class="bk-tl-icon">

<div class="row g-4">

<!-- ================= LEFT ================= -->
<div class="col-lg-6">

<div class="bk-section">
<h5>ğŸ“„ Informasi Laporan</h5>

<p><strong>Kode :</strong> {{ laporan.kode_laporan }}</p>

<p>
<strong>Status :</strong>
<span class="badge
{% if laporan.status == 'selesai' %}bg-success
{% elif laporan.status == 'diproses' %}bg-warning text-dark
{% else %}bg-secondary{% endif %}">
{{ laporan.get_status_display }}
</span>
</p>

<p><strong>Tanggal Lapor :</strong> {{ laporan.tanggal|date:"d M Y" }}</p>

</div>

<div class="bk-section">
<h5>â° Waktu & Lokasi</h5>

<p>
<strong>Waktu :</strong>
{{ laporan.tanggal_kejadian|date:"d M Y" }}
{% if laporan.perkiraan_waktu %}
({{ laporan.get_perkiraan_waktu_display }})
{% endif %}
</p>

<p><strong>Lokasi :</strong> {{ laporan.lokasi_kejadian|default:"-" }}</p>

</div>

<div class="bk-section">
<h5>ğŸ‘¤ Korban & Terlapor</h5>

<p>
<strong>Korban :</strong>
{{ laporan.tampilkan_korban }} ({{ laporan.kelas_korban }})
</p>

{% if laporan.is_korban_anonim %}
<details class="mt-2">
<summary>ğŸ” Identitas Korban Internal</summary>

<div class="mt-2">
<p><strong>Nama :</strong> {{ laporan.nama_korban }}</p>
<p><strong>Kelas :</strong> {{ laporan.kelas_korban }}</p>
</div>
</details>
{% endif %}

{% if laporan.nama_terlapor %}
<p>
<strong>Terlapor :</strong>
{{ laporan.nama_terlapor }}
{% if laporan.kelas_terlapor %}
({{ laporan.kelas_terlapor }})
{% endif %}
</p>
{% endif %}

<p><strong>Jenis :</strong> {{ laporan.get_jenis_bullying_display }}</p>

</div>

</div>

<!-- ================= RIGHT ================= -->
<div class="col-lg-6">

<div class="bk-section">
<h5>ğŸ“ Kronologi</h5>
<p>{{ laporan.isi_laporan|linebreaksbr }}</p>
</div>

{% if laporan.dampak_korban %}
<div class="bk-section">
<h5>âš  Dampak</h5>
<ul>
{% for d in laporan.dampak_korban %}
<li>{{ d }}</li>
{% endfor %}
</ul>
</div>
{% endif %}

{% if laporan.dampak_lainnya %}
<div class="bk-section">
<p><strong>Dampak Lainnya :</strong> {{ laporan.dampak_lainnya }}</p>
</div>
{% endif %}

{% if laporan.harapan_pelapor %}
<div class="bk-section">
<h5>ğŸ™ Harapan Pelapor</h5>
<p>{{ laporan.harapan_pelapor|linebreaksbr }}</p>
</div>
{% endif %}

{% if laporan.bukti %}
<a href="{{ laporan.bukti.url }}"
target="_blank"
class="bk-tl-btn-success mt-2">
ğŸ“ Lihat Bukti Pelapor
</a>
{% endif %}

</div>

</div>

<hr class="my-4">

<!-- IDENTITAS PELAPOR -->
<details class="bk-section">
<summary>ğŸ” Identitas Pelapor Internal</summary>

<div class="mt-3">
<p>
<strong>Nama :</strong>
{{ laporan.pelapor.get_full_name|default:laporan.pelapor.username }}
</p>

<p><strong>NIS :</strong> {{ laporan.pelapor.profile.nis }}</p>
<p><strong>Kelas :</strong> {{ laporan.pelapor.profile.kelas }}</p>
</div>
</details>

<hr class="my-4">

<!-- FORM BK -->
<form method="post" enctype="multipart/form-data">

{% csrf_token %}

<div class="bk-section">
<label class="bk-tl-label">Catatan Guru BK</label>
{{ form.catatan_bk }}
</div>

<div class="bk-section">
<label class="bk-tl-label">Bukti Tindak Lanjut</label>
{{ form.bukti_tindak_lanjut }}
</div>

<button type="submit" class="bk-tl-btn-primary w-100">
ğŸ’¾ Simpan Tindak Lanjut
</button>

{% if laporan.status != "selesai" %}
<button type="submit"
name="selesai"
value="1"
class="btn btn-success w-100 mt-2">
âœ” Tandai Selesai
</button>
{% endif %}

</form>

<a href="{% url 'bk_dashboard' %}"
class="btn btn-outline-secondary w-100 mt-3">
â† Kembali ke Dashboard
</a>

</div>
</div>
</div>
</div>
</section>

{% endblock %}
