{% extends 'base.html' %}
{% load static %}
{% block title %}Dashboard Guru BK{% endblock %}

{% block content %}
<div class="bk-dashboard-page">

  <div class="bk-dashboard">

    <!-- ================= HEADER ================= -->
    <header class="dashboard-header">
      <div>
        <span class="bk-badge">Akses Khusus Guru BK</span>
        <h1>Dashboard Guru BK</h1>
        <p>Kelola dan pantau laporan bullying dari siswa</p>
      </div>

      <a href="{% url 'bk_download_laporan' %}" class="btn-download">
        <i class="bi bi-download"></i> Download Laporan
      </a>
    </header>

    <!-- ================= SUMMARY ================= -->
    <section class="dashboard-cards">

      <div class="summary-card">
        <div class="summary-header">
          <span class="icon bg-blue"><i class="bi bi-file-earmark-text"></i></span>
          <p>Total Laporan</p>
        </div>
        <h2>{{ total_laporan }}</h2>
      </div>

      <div class="summary-card">
        <div class="summary-header">
          <span class="icon bg-orange"><i class="bi bi-patch-plus"></i></span>
          <p>Laporan Baru</p>
        </div>
        <h2>{{ laporan_baru }}</h2>
      </div>

      <div class="summary-card">
        <div class="summary-header">
          <span class="icon bg-purple"><i class="bi bi-hourglass-split"></i></span>
          <p>Sedang Diproses</p>
        </div>
        <h2>{{ sedang_diproses }}</h2>
      </div>

      <div class="summary-card">
        <div class="summary-header">
          <span class="icon bg-green"><i class="bi bi-check-circle"></i></span>
          <p>Selesai Ditangani</p>
        </div>
        <h2>{{ selesai }}</h2>
      </div>

    </section>

    <!-- ================= MAIN ================= -->
    <main class="dashboard-content">

      <!-- ================= LEFT ================= -->
      <section class="dashboard-left">

        <!-- SEARCH -->
        <form method="get" class="search-box">
          <input type="hidden" name="status" value="{{ status_filter }}">
          <input
            type="text"
            name="q"
            placeholder="Cari kode laporan..."
            value="{{ query|default:'' }}"
          >
          <button type="submit">
            <i class="bi bi-search"></i>
          </button>
        </form>

        <!-- FILTER -->
        <div class="filter-bar">
          <a href="?status=all"
             class="filter-btn {% if status_filter == 'all' %}active{% endif %}">
            Semua
          </a>
          <a href="?status=baru"
             class="filter-btn {% if status_filter == 'baru' %}active{% endif %}">
            Baru
          </a>
          <a href="?status=diproses"
             class="filter-btn {% if status_filter == 'diproses' %}active{% endif %}">
            Diproses
          </a>
          <a href="?status=selesai"
             class="filter-btn {% if status_filter == 'selesai' %}active{% endif %}">
            Selesai
          </a>
        </div>

        <!-- ================= LIST LAPORAN ================= -->
        <div class="laporan-card">
          <h3>Daftar Laporan</h3>

          {% for lap in laporan %}
          <div class="laporan-item">

            <div class="laporan-top d-flex justify-content-between align-items-center">
              <strong>{{ lap.kode_laporan }}</strong>

              <span class="status
                {% if lap.status == 'selesai' %}
                  selesai
                {% elif lap.status == 'diproses' %}
                  proses
                {% else %}
                  baru
                {% endif %}
              ">
                {{ lap.get_status_display }}
              </span>
            </div>

            <!-- ANONIM DI LIST -->
            <p class="laporan-meta">
              <strong>Pelapor:</strong> Anonim ðŸ”’
              â€¢ {{ lap.get_jenis_bullying_display }}
              â€¢ {{ lap.tanggal|date:"d M Y" }}
            </p>

            <!-- INFO TAMBAHAN -->
            <p class="laporan-meta">
              <strong>Kejadian:</strong>
              {{ lap.tanggal_kejadian|date:"d M Y" }}
              ({{ lap.get_perkiraan_waktu_display }})
              â€¢ <strong>Lokasi:</strong> {{ lap.lokasi_kejadian }}
            </p>

            <a href="{% url 'bk_tindak_lanjut' lap.id %}" class="btn-detail">
              <i class="bi bi-eye"></i> Lihat Detail
            </a>

          </div>
          {% empty %}
          <p class="empty">Tidak ada laporan</p>
          {% endfor %}
        </div>

      </section>

      <!-- ================= RIGHT ================= -->
      <aside class="dashboard-right">

        <!-- STATISTIK KELAS -->
        <div class="side-card">
          <h4><i class="bi bi-bar-chart"></i> Statistik Kelas Korban</h4>
          {% for k in statistik_kelas %}
          <div class="stat-row">
            <span>{{ k.kelas_korban }}</span>
            <span>{{ k.total }}</span>
          </div>
          {% empty %}
          <p class="text-muted small">Belum ada data</p>
          {% endfor %}
        </div>

        <!-- AKTIVITAS -->
        <div class="side-card">
          <h4><i class="bi bi-clock-history"></i> Aktivitas Terkini</h4>
          <ul class="activity-list">
            {% for a in aktivitas_terkini %}
            <li>
              <strong>{{ a.kode_laporan }}</strong><br>
              <small>{{ a.tanggal|timesince }} lalu</small>
            </li>
            {% empty %}
            <li class="text-muted">Belum ada aktivitas</li>
            {% endfor %}
          </ul>
        </div>

      </aside>

    </main>

  </div>
</div>
{% endblock %}
