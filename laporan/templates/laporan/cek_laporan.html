{% extends 'base.html' %}
{% load static %}

{% block title %}Cek Status Laporan{% endblock %}

{% block content %}
<section class="cek-laporan-hero cek-laporan-page">
  <div class="container text-center">

    <h1 class="cek-laporan-title">Cek Status Laporan</h1>
    <p class="cek-laporan-subtitle">
      Kerahasiaan identitas dijaga untuk keamanan semua pihak
    </p>

    <!-- ================= INPUT KODE ================= -->
    <div class="cek-laporan-card mx-auto mt-5">
      <img src="{% static 'img/shield.png' %}" class="cek-laporan-icon">

      <h3 class="cek-laporan-card-title">Masukkan Kode Laporan</h3>

      <form method="post">
        {% csrf_token %}
        <input
          type="text"
          name="kode"
          class="cek-laporan-input form-control text-center mb-4"
          placeholder="Masukkan kode laporan"
          required
        >

        <button type="submit" class="cek-laporan-btn-primary w-100">
          Cek Status
        </button>
      </form>
    </div>

    <!-- ================= HASIL ================= -->
    {% if laporan %}
    <div class="cek-laporan-detail-card mx-auto mt-5 p-4">

      <div class="text-center">
        <img src="{% static 'img/ribbon.png' %}" class="cek-laporan-icon mb-3">
        <h3 class="cek-laporan-detail-title">Detail Laporan</h3>
      </div>

      <div class="mt-4 text-start">

        <!-- üîí PELAPOR SELALU ANONIM -->
        <p>
          <strong>Pelapor :</strong> Anonim üîí
        </p>

        <!-- ‚≠ê KORBAN SUPPORT ANONIM -->
        <p>
          <strong>Korban :</strong>
          {{ laporan.tampilkan_korban(request.user) }}
          ({{ laporan.kelas_korban }})
        </p>

        <!-- TERLAPOR -->
        {% if laporan.nama_terlapor %}
        <p>
          <strong>Terlapor :</strong>
          {{ laporan.nama_terlapor }}
          {% if laporan.kelas_terlapor %}
            ({{ laporan.kelas_terlapor }})
          {% endif %}
        </p>
        {% endif %}

        <p>
          <strong>Jenis Perundungan :</strong>
          {{ laporan.get_jenis_bullying_display }}
        </p>

        <hr>

        <!-- ================= WAKTU & TEMPAT ================= -->
        <p>
          <strong>Waktu Kejadian :</strong>
          {{ laporan.tanggal_kejadian|date:"d M Y" }}
          {% if laporan.perkiraan_waktu %}
            ({{ laporan.get_perkiraan_waktu_display }})
          {% endif %}
        </p>

        <p>
          <strong>Lokasi :</strong>
          {{ laporan.lokasi_kejadian|default:"-" }}
        </p>

        <hr>

        <!-- ================= KRONOLOGI ================= -->
        <p><strong>Kronologi :</strong></p>
        <p>
          {{ laporan.isi_laporan|linebreaksbr }}
        </p>

        <!-- ================= DAMPAK ================= -->
        {% if laporan.dampak_korban %}
        <p><strong>Dampak :</strong></p>
        <ul>
          {% for d in laporan.dampak_korban %}
            <li>{{ d }}</li>
          {% endfor %}
        </ul>
        {% endif %}

        {% if laporan.dampak_lainnya %}
        <p>
          <strong>Dampak Lainnya :</strong>
          {{ laporan.dampak_lainnya }}
        </p>
        {% endif %}

        <!-- ================= HARAPAN ================= -->
        {% if laporan.harapan_pelapor %}
        <hr>
        <p><strong>Harapan Pelapor :</strong></p>
        <p>
          {{ laporan.harapan_pelapor|linebreaksbr }}
        </p>
        {% endif %}

      </div>

      <hr>

      <!-- ================= STATUS ================= -->
      <div class="text-center">
        <h3>Status Laporan</h3>
        <p class="cek-laporan-status">
          {{ laporan.get_status_display }}
        </p>
      </div>

      <!-- ================= CATATAN BK ================= -->
      {% if laporan.catatan_bk %}
      <div class="card bg-light border-0 p-3 mb-3">
        <h5>Catatan Guru BK</h5>
        <p>{{ laporan.catatan_bk|linebreaksbr }}</p>
      </div>
      {% endif %}

      <!-- ================= BUKTI BK ================= -->
      <div class="d-grid gap-2">
        {% if laporan.bukti_tindak_lanjut %}
        <a href="{{ laporan.bukti_tindak_lanjut.url }}"
           target="_blank"
           class="cek-laporan-btn-success w-100">
          üìé Lihat Bukti Tindak Lanjut
        </a>
        {% endif %}

        <a href="{% url 'laporan_home' %}"
           class="btn btn-outline-secondary w-100">
          ‚Üê Kembali
        </a>
      </div>

    </div>
    {% endif %}

  </div>
</section>
{% endblock %}
